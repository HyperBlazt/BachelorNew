// http://thecurlybrace.blogspot.dk/2010/12/how-to-create-c-windows-service.html d. 12-12-2016

using System;
using System.Diagnostics;
using System.Text;

namespace MalwareDetectionSystem
{
    public static class EventLogExtensions
    {
        public static void WriteEntry(this EventLog log,
          string message,
          EventLogEntryType type,
          int eventId,
          Exception ex)
        {
            if (String.IsNullOrWhiteSpace(message))
                throw new ArgumentException("message is null or empty.", "message");
            if (ex == null)
                throw new ArgumentNullException("ex", "ex is null.");

            string seperator = new String('-', 50);
            StringBuilder builder = new StringBuilder(message);

            // Write each of the inner exception messages.
            Exception parentException = ex;
            bool isInnerException = false;
            do
            {
                builder.AppendLine();
                builder.AppendLine(seperator);
                if (isInnerException)
                    builder.Append("INNER ");
                builder.AppendLine("EXCEPTION DETAILS");
                builder.AppendLine();
                builder.Append("EXCEPTION TYPE:\t");
                builder.AppendLine(parentException.GetType().ToString());
                builder.AppendLine();
                builder.Append("EXCEPTION MESSAGE:\t");
                builder.AppendLine(parentException.Message);
                builder.AppendLine();
                builder.AppendLine("STACK TRACE:");
                builder.AppendLine(parentException.StackTrace);
                if (parentException.InnerException != null)
                {
                    parentException = parentException.InnerException;
                    isInnerException = true;
                }
            }
            while (parentException != null);

            log.WriteEntry(builder.ToString(), EventLogEntryType.Error, eventId);
        }
    }
}